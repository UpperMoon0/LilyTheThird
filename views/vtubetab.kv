#:kivy 2.0.0
#:import RGBStrip views.components.rgb_strip.RGBStrip
#:import VTSAnimationList views.components.vts_animation_list.VTSAnimationList
#:import VTSParamList views.components.vts_param_list.VTSParamList

<VTubeTab>:
    orientation: 'vertical'
    spacing: '10dp'
    padding: '10dp'

    # --- Top Row: RGB Strip and Connection Status ---
    RGBStrip:
        size_hint_y: None
        height: dp(3) # Keep it thin

    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: None
        height: '40dp'
        spacing: '10dp'

        Label:
            id: status_label
            text: root.status_text
            size_hint_x: 0.7

        Button:
            id: connect_button
            text: root.button_text
            size_hint_x: 0.3
            on_press: root.toggle_connection()
            disabled: self.text in ["Connecting...", "Disconnecting..."]

    # --- Main Content: Two Columns ---
    BoxLayout:
        orientation: 'horizontal'
        spacing: '10dp'
        size_hint_y: 1 # Take remaining vertical space

        # --- Column A: Animation List (40% width) ---
        BoxLayout:
            id: column_a
            orientation: 'vertical'
            size_hint_x: 0.4
            spacing: '5dp'

            TextInput:
                id: animation_search_input
                hint_text: "Search animations..."
                size_hint_y: None
                height: dp(30)
                multiline: False
                on_text: root.filter_animations(self.text)

            VTSAnimationList:
                id: vts_animation_list_widget
                size_hint_y: 1 # Take remaining space in column A
                # Connect events to root (VTubeTab) methods
                on_trigger_animation: root.trigger_vts_animation(args[1])
                on_add_animation: root.handle_add_new_animation_button() # Renamed handler for clarity
                on_edit_animation: root.handle_edit_animation_selection(args[1]) # Renamed handler
                # on_delete_animation: root.handle_delete_animation(args[1]) # Keep if delete is implemented

        # --- Column B: Editor Panel (60% width) ---
        BoxLayout:
            id: column_b_editor
            orientation: 'vertical'
            size_hint_x: 0.6
            spacing: '10dp'
            # Add a visual separator/background (optional)
            canvas.before:
                Color:
                    rgba: 0.15, 0.15, 0.15, 0.9 # Slightly dark background
                Rectangle:
                    pos: self.pos
                    size: self.size

            Label:
                id: editor_title_label
                text: "Animation Editor" # Default title
                size_hint_y: None
                height: dp(30)
                font_size: '18sp'
                bold: True
                halign: 'center'

            BoxLayout: # Name Input Row
                size_hint_y: None
                height: dp(35)
                Label:
                    text: "Name:"
                    size_hint_x: 0.2
                    halign: 'right'
                    valign: 'middle'
                    text_size: self.size
                TextInput:
                    id: editor_animation_name_input # ID for Python access
                    size_hint_x: 0.8
                    multiline: False
                    write_tab: False

            Label: # Parameters Title
                text: "Set Parameter Values:"
                size_hint_y: None
                height: dp(25)
                halign: 'left'
                valign: 'middle'
                text_size: self.width, None
                bold: True

            VTSParamList:
                id: editor_param_list # ID for Python access
                size_hint_y: 1 # Take remaining vertical space in editor

            BoxLayout: # Action Buttons Row
                size_hint_y: None
                height: dp(45)
                spacing: dp(10)

                Button:
                    id: editor_save_button
                    text: "Save Animation"
                    size_hint_x: 1.0 # Changed from 0.5 to take full width
                    on_press: root.save_edited_animation()
                    disabled: not root.is_editing # Disable if not editing/adding

                # Removed the Cancel button
                # Button:
                #     id: editor_cancel_button
                #     text: "Cancel / Clear"
                #     size_hint_x: 0.5
                #     on_press: root.cancel_edit()
                #     disabled: not root.is_editing # Disable if not editing/adding
